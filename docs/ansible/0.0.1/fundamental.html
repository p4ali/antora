<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled :: Antora Site</title>
    <link rel="canonical" href="https://p4ali.github.io/antora/ansible/0.0.1/fundamental.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="#">Developer Notes</a>
        <span class="separator">//</span>
        <a href="https://p4ali.github.io/antora">Docs</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
<!--
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Projects</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>Core</strong></div>
            <a class="navbar-item" href="https://gitlab.com/antora/antora">Repository</a>
            <a class="navbar-item" href="https://gitlab.com/antora/antora/issues">Issue Tracker</a>
            <hr class="navbar-divider">
            <div class="navbar-item"><strong>Default UI</strong></div>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default">Repository</a>
            <a class="navbar-item" href="https://gitlab.com/antora/antora-ui-default/issues">Issue Tracker</a>
            <hr class="navbar-divider">
            <a class="navbar-item" href="https://gitlab.com/antora/antora/blob/master/contributing.adoc">Contributing</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Community</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://gitter.im/antora/users">Chat (Users)</a>
            <a class="navbar-item" href="https://gitter.im/antora/dev">Chat (Dev)</a>
          </div>
        </div>
      </div>
    </div>
-->
  </nav>
</header>

<div class="main-wrapper">
<div class="navigation-container" data-component="ansible" data-version="0.0.1">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="fundamental.html">Ansible Hands-on</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="fundamental.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="inventory.html">Inventory</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="module.html">Module</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="playbook.html">Playbook</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="role.html">Role</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="inline-text-formatting.html">Basic Inline Text Formatting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Lists</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#">lists/ordered-list.adoc</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#">lists/unordered-list.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Ansible Hands-on</span>
    <span class="version">0.0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Ansible Hands-on</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="fundamental.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Numpy stack in python</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../numpy/0.0.1/environment.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Service Mesh</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mesh/0.0.1/envoy/envoy.html">0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../mesh/0.0.1/network.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="fundamental.html">Ansible Hands-on</a></li>
    <li class="crumb"><a href="fundamental.html">Fundamentals</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///workspaces/github/hands_on_ansible/docs/modules/ROOT/pages/fundamental.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<div class="sect1">
<h2 id="_centos_centos7_setup_remote_hosts"><a class="anchor" href="#_centos_centos7_setup_remote_hosts"></a>CentOS (centos/7) setup (remote hosts)</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># install from source with pip
sudo yum install gcc -y
sudo yum install python-setuptools -y
sudo easy_install pip
sudo yum install python-devel -y
sudo pip install ansible

# amending the /etc/ssh/sshd_config 'PasswordAuthentication yes'
# then re-started the service 'sudo systemctl restart sshd'
sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config;
sudo systemctl restart sshd

# Alternatively, you can install ansible this way
sudo yum install epel-release -y
sudo yum install ansible -y</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ubuntu_ubuntuxenial64_setup_access_control_host"><a class="anchor" href="#_ubuntu_ubuntuxenial64_setup_access_control_host"></a>Ubuntu (ubuntu/xenial64) setup (access control host)</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo apt-add-repository ppa:ansible/ansible -y
sudo apt-get update &amp;&amp; sudo apt-get install ansible -y

# note: in order to make password based auth (-k) work, you have to enable it, e.g.
# vi /etc/ssh/sshd_config
#    PasswordAuthentication yes
# $ service sshd restart
# also need ssh vagrant@192.168.33.20 to add finger print, -k will prompt password
# Or set host_key_checking=false in ansible.cfg
# https://stackoverflow.com/questions/42462435/ansible-provisioning-error-using-a-ssh-password-instead-of-a-key-is-not-possibl
ansible 192.168.33.20 -i inventory -u vagrant -m ping -k</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_setup"><a class="anchor" href="#_key_setup"></a>Key setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nowdays, most OS by default will disable the plain password based authentication for security reason.
The alternative is public/private key based authentication. The idea is keep private key only on your
local pc, and upload the public key to the remote host. Then the authentication can be done using PKS.</p>
</div>
<div class="paragraph">
<p>For ansible, the best way is using PKS for auth. Here is the normal flow for key deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>generate a key pair on any machine with ssh-keygen</p>
</li>
<li>
<p>upload pub key to the remote host</p>
</li>
<li>
<p>save the private key to your local pc</p>
</li>
<li>
<p>pass the private key when talking to reemote host. e.g.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Using -vvv to print debug info
ansible  -i '192.168.33.30,' all  --private-key=./my_rsa_key_pair -m ping -u vagrant -vvv</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_execution_and_flow"><a class="anchor" href="#_execution_and_flow"></a>Execution and flow</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>evaluate the playbook and create a python package for the playbook</p>
</li>
<li>
<p>scp the python package to remote host tmp directory</p>
</li>
<li>
<p>python on remote run the package, and return result (with json) to ansible control server, then delete the package</p>
</li>
<li>
<p>continue with next play</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_execution_types"><a class="anchor" href="#_execution_types"></a>Execution types</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>remote - upload package to remote and exec, mostly use webapi</p>
</li>
<li>
<p>local - when local (ansible server, not remote host) host executes plays</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_architecture"><a class="anchor" href="#_ansible_architecture"></a>Ansible architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="_images/ansible_components.png" alt="ansible components"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>inventory maps hosts</p>
</li>
<li>
<p>configuration sets ansible parameters</p>
</li>
<li>
<p>modules define actions</p>
</li>
<li>
<p>playbooks to coordinate multiple plays (play is a single or set of task)</p>
</li>
<li>
<p>python to build the execution packages locally</p>
</li>
<li>
<p>ssh to deliver packages (the tasks) to remote and run</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_basic_command"><a class="anchor" href="#_ansible_basic_command"></a>Ansible basic command</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Include system, inventory file, module, and user</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ansible &lt;system&gt;
  -i &lt;inventoryFile&gt;
  -m &lt;module&gt;
  -a &lt;module arguments&gt;
  -u &lt;username&gt;
  -s Use "sudo" to run the commands
  -k &lt;password prompt&gt;
  --private-key=&lt;path_to_private_key&gt;
  -v (-vv debug level2/-vvv debug level3)

# e.g.
# the ',' is important, it means list of values.
# not regular ping command, it just verify ability to login inventory and a usable python is configure.
ansible  -i '192.168.33.30,'  --private-key=./my_rsa_key_pair  -m ping all -vvv -u vagrant

# run the ls command on all inventory
ansible  -i '192.168.33.30,'  --private-key=./my_rsa_key_pair all -m shell -a 'ls /' -vvv -u vagrant</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_terms"><a class="anchor" href="#_terms"></a>Terms</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Inventory: ansible hosts file, i.e., the managed hosts ip, users etc</p>
<div class="ulist">
<ul>
<li>
<p>multiple inventory files for diff envs</p>
</li>
</ul>
</div>
</li>
<li>
<p>Modules: A programmed unit of work to be done, e.g., yaml module</p>
</li>
<li>
<p>Playbook: Glue bring all modules together, it contains a set of plays. In other words, it is a set of plays build in specific order sequence to produce an expected outcome or outcomes across many different sets of hosts.</p>
</li>
<li>
<p>Play: a single or set of tasks using modules, executed on a defined set of hosts. e.g., copy  a file, start a server, install a software, etc</p>
</li>
<li>
<p>Ansible Config: Global config, such as how many parallel operation sys perform. It can be overriden in following order (high-low):</p>
<div class="ulist">
<ul>
<li>
<p>$ANSIBLE_CONFIG, you can override specific settings by prefixing <strong>ANSIBLE_</strong> to the name e.g., export ANSIBLE_FORKS=10, export ANSIBLE_host_key_checking=false, etc</p>
</li>
<li>
<p>./ansible.cfg</p>
</li>
<li>
<p>~/.ansible.cfg</p>
</li>
<li>
<p>/etc/ansible/ansible.cfg (may not exist)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Python:</p>
</li>
<li>
<p>Variables:</p>
<div class="ulist">
<ul>
<li>
<p>Host Variables - defined in inventory file per host or group</p>
</li>
<li>
<p>Facts - gathered from the remote managed host, such as ip, os, cpu speed</p>
</li>
<li>
<p>Dynamic variables - use data gathered by tasks or created at runtime</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ansible Module (such as ping, copy, yum, apt etc)</p>
<div class="ulist">
<ul>
<li>
<p><code>ansible-doc -l</code>, <code>ansible-doc yum</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://www.mydailytutorials.com/ansible-register-variables/">Return values</a></p>
<div class="ulist">
<ul>
<li>
<p><code>with_items</code> to loop through an array/list, each element is named <code>item</code>, where <code>item.0</code> is index and <code>item.1</code> is value</p>
</li>
<li>
<p><a href="http://www.mydailytutorials.com/working-with-ansible-loop/">work with loops in ansible</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs"><a class="anchor" href="#_docs"></a>Docs</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ansible-doc ping -s
ansible-doc -l</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial"><a class="anchor" href="#_tutorial"></a>Tutorial</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://serversforhackers.com/c/an-ansible2-tutorial">An Ansible2 tutoiral</a></p>
</li>
<li>
<p><a href="https://github.com/ansible/ansible-examples">Ansible Example Git Repo</a></p>
</li>
<li>
<p><a href="https://www.pluralsight.com/courses/hands-on-ansible">hands on ansible on pluralsight</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
